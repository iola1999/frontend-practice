<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>demo</title>
</head>
<body>
<div id="test"></div>
<script src="https://cdn.bootcdn.net/ajax/libs/react/17.0.2/umd/react.development.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/react-dom/17.0.2/umd/react-dom.development.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/prop-types/15.7.2/prop-types.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/babel-standalone/7.0.0-beta.3/babel.js"></script>
<script type="text/babel">
    // https://zh-hans.reactjs.org/docs/hooks-faq.html#what-can-i-do-if-my-effect-dependencies-change-too-often
    function Counter() {
        const [count, setCount] = React.useState(0);
        // ä¸ºäº†ä¼˜åŒ–æ€§èƒ½ï¼Œå¯ä»¥ä½¿ç”¨ æ¡ä»¶å¼çš„å‘èµ· effectï¼Œè·³è¿‡ä¸€äº› state/props å˜åŒ–å¼•èµ·çš„ effect
        React.useEffect(() => {
            const id = setInterval(() => {
                setCount(count + 1); // è¿™ä¸ª effect ä¾èµ–äº `count` state
            }, 1000);
            return () => clearInterval(id);
        }, []); // ğŸ”´ Bug: `count` æ²¡æœ‰è¢«æŒ‡å®šä¸ºä¾èµ–
        // å½“ effect æ‰§è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å°† count çš„å€¼è¢«ä¿å­˜åœ¨è¯¥é—­åŒ…å½“ä¸­ï¼Œä¸”åˆå€¼ä¸º 0ã€‚
        // æ¯éš”ä¸€ç§’ï¼Œå›è°ƒå°±ä¼šæ‰§è¡Œ setCount(0 + 1)ï¼Œå› æ­¤ï¼Œcount æ°¸è¿œä¸ä¼šè¶…è¿‡ 1ã€‚

        return <h1>{count}</h1>;
    }

    // å¯ä»¥ç»™ä¾èµ–é¡¹åŠ ä¸Š countï¼ˆä½†æ˜¯è¿™è·Ÿä¸å†™å¥½åƒæ²¡å•¥åŒºåˆ«ï¼Ÿï¼‰
    // ä¹Ÿå¯ä»¥è¿™æ ·ï¼š
    // setCount(c => c + 1); // âœ… åœ¨è¿™ä¸ä¾èµ–äºå¤–éƒ¨çš„ `count` å˜é‡
    // setCount å‡½æ•°çš„èº«ä»½æ˜¯è¢«ç¡®ä¿ç¨³å®šçš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒçš„çœç•¥æ‰ä¾èµ–


    // å¦ä¸€ä»¶äº‹ï¼Œ
    // ä¸‡ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ æŠŠå‡½æ•°åŠ å…¥ effect çš„ä¾èµ–ä½† æŠŠå®ƒçš„å®šä¹‰åŒ…è£¹ è¿› useCallback Hookã€‚è¿™å°±ç¡®ä¿äº†å®ƒä¸éšæ¸²æŸ“è€Œæ”¹å˜ï¼Œé™¤é å®ƒè‡ªèº« çš„ä¾èµ–å‘ç”Ÿäº†æ”¹å˜ï¼š
    function ProductPage({productId}) {
        // âœ… ç”¨ useCallback åŒ…è£¹ä»¥é¿å…éšæ¸²æŸ“å‘ç”Ÿæ”¹å˜
        const fetchProduct = React.useCallback(() => {
            // ... Does something with productId ...
        }, [productId]); // âœ… useCallback çš„æ‰€æœ‰ä¾èµ–éƒ½è¢«æŒ‡å®šäº†

        return <ProductDetails fetchProduct={fetchProduct}/>;
    }

    function ProductDetails({fetchProduct}) {
        React.useEffect(() => {
            fetchProduct();
        }, [fetchProduct]); // âœ… useEffect çš„æ‰€æœ‰ä¾èµ–éƒ½è¢«æŒ‡å®šäº†
        // ...
    }

    const VDom = (<Counter/>)
    ReactDOM.render(VDom, document.getElementById("test"))


    // ä¾‹å¦‚å†™ä¸€ä¸ªè‡ªå®šä¹‰ hookï¼š
    /**
     const timer = useInterval(()=>{
        console.log(`æˆ‘æ˜¯ç¼–å·ä¸º${timer}çš„å®šæ—¶å™¨`)
    },1000)
     // æ¸…é™¤å®šæ—¶å™¨
     clearInterval(timer)
     **/

    // export default
    function useInterval(callback, time = 300) {
        const intervalFn = React.useRef({});
        React.useEffect(() => {
            intervalFn.current.callback = callback;
        })
        React.useEffect(() => {
            intervalFn.current.timer = setInterval(() => {
                intervalFn.current()
            }, time)
            return () => {
                intervalFn.current.timer &&
                clearInterval(intervalFn.current.timer)
            }
        }, [time])
        return intervalFn.current.timer
    }

    // å¸¸ç”¨è‡ªå®šä¹‰ hook å†™æ³•ï¼šhttps://blog.csdn.net/roamingcode/article/details/105596963
</script>
</body>
</html>
